<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presale Token Kripto</title>
    <style>body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 800px;
    margin: 20px auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
}

#walletInfo, #purchase, #transactionHistory {
    margin-bottom: 20px;
}

#purchase input[type="number"] {
    padding: 8px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 200px;
}

#purchase button {
    padding: 8px 20px;
    font-size: 16px;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
}

#transactionList {
    white-space: pre-line;
}

</style>
</head>
<body>
    <div class="container">
        <h1>Presale Token Kripto</h1>
        <div id="walletInfo">
            <h3>Wallet Info</h3>
            <p><strong>Address:</strong> <span id="walletAddress">Connecting...</span></p>
            <p><strong>Balance:</strong> <span id="walletBalance">Loading...</span> BNB</p>
            <p><strong>Estimated Assets:</strong> <span id="estimatedAssets">Loading...</span> Tokens</p>
        </div>
        <div id="purchase">
            <h3>Purchase Tokens</h3>
            <p>
                <label for="bnbAmount">BNB Amount:</label>
                <input type="number" id="bnbAmount" step="0.01" placeholder="Enter BNB amount">
                <button onclick="buyWithBNB()">Buy with BNB</button>
            </p>
            <p>
                <label for="usdtAmount">USDT Amount:</label>
                <input type="number" id="usdtAmount" step="0.01" placeholder="Enter USDT amount">
                <button onclick="buyWithUSDT()">Buy with USDT</button>
            </p>
        </div>
        <div id="transactionHistory">
            <h3>Transaction History</h3>
            <p id="transactionList">Loading...</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.5.2/web3.min.js" integrity="sha512-B0fPbFn+w6/PSM1peTtsNJXsSUD+49U+3Qz4hoK57rGd1N3W2S0S5Y0b18tP7zP9lJ8XHfHxwlyHukg4GJsjYQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>// Script for connecting wallet and interacting with smart contract

let web3;
let presale;
let token;

// Web3 initialization
async function initWeb3() {
    if (window.ethereum) {
        window.web3 = new Web3(window.ethereum);
        try {
            await window.ethereum.enable();
            console.log('Web3 initialized successfully');
            await initContracts();
        } catch (error) {
            console.error('User denied account access');
        }
    } else if (window.web3) {
        window.web3 = new Web3(window.web3.currentProvider);
        console.log('Web3 initialized successfully');
        await initContracts();
    } else {
        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
    }
}

// Initialize presale and token contracts
async function initContracts() {
    const networkId = await web3.eth.net.getId();
    const presaleAddress = 'YOUR_PRESALE_CONTRACT_ADDRESS';
    const tokenAddress = 'YOUR_TOKEN_CONTRACT_ADDRESS';

    try {
        presale = new web3.eth.Contract(PresaleABI, presaleAddress);
        token = new web3.eth.Contract(TokenABI, tokenAddress);
        console.log('Contracts initialized successfully');
        connectWallet();
    } catch (error) {
        console.error('Failed to initialize contracts', error);
    }
}

// Connect wallet function
async function connectWallet() {
    try {
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        document.getElementById('walletAddress').textContent = accounts[0];
        updateWalletInfo();
    } catch (error) {
        console.error(error);
    }
}

// Update wallet info function
async function updateWalletInfo() {
    try {
        const accounts = await ethereum.request({ method: 'eth_accounts' });
        const address = accounts[0];
        const balance = await web3.eth.getBalance(address);
        const tokenBalance = await token.methods.balanceOf(address).call();
        document.getElementById('walletAddress').textContent = address;
        document.getElementById('walletBalance').textContent = web3.utils.fromWei(balance, 'ether');
        document.getElementById('estimatedAssets').textContent = tokenBalance;
        getTransactionHistory(address);
    } catch (error) {
        console.error(error);
    }
}

// Buy tokens with BNB function
async function buyWithBNB() {
    try {
        const bnbAmount = document.getElementById('bnbAmount').value;
        await presale.methods.buyWithBNB().send({ value: web3.utils.toWei(bnbAmount, 'ether') });
        updateWalletInfo();
    } catch (error) {
        console.error(error);
    }
}

// Buy tokens with USDT function
async function buyWithUSDT() {
    try {
        const usdtAmount = document.getElementById('usdtAmount').value;
        // Assume you have implemented a function to transfer USDT tokens
        await transferUSDT(usdtAmount);
        updateWalletInfo();
    } catch (error) {
        console.error(error);
    }
}

// Get transaction history function
async function getTransactionHistory(address) {
    try {
        const transactions = await fetchTransactionHistory(address);
        document.getElementById('transactionList').textContent = transactions;
    } catch (error) {
        console.error(error);
    }
}

// Fetch transaction history from backend API
async function fetchTransactionHistory(address) {
    try {
        const response = await fetch(`https://api.yourbackend.com/transactions?address=${address}`);
        if (!response.ok) {
            throw new Error('Failed to fetch transaction history');
        }
        const transactions = await response.json();
        return transactions.map(tx => `Tx Hash: ${tx.hash}, Amount: ${tx.amount}`).join('\n');
    } catch (error) {
        console.error(error);
        return 'Failed to fetch transaction history';
    }
}

// Initialize web3 and connect wallet when the page loads
window.addEventListener('load', async () => {
    await initWeb3(); // Initiate web3
});
</script>
</body>
</html>
