<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airdrop Claim</title>
    <style>
      body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #2c2c2c 10%, #3c3c3c 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    overflow: hidden;
}

.container {
    background: rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 2rem;
    text-align: center;
    max-width: 400px;
    margin: auto;
}

h1 {
    color: #fff;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
}

button {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    border: none;
    border-radius: 10px;
    background: linear-gradient(135deg, #7f00ff 0%, #e100ff 100%);
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

button:hover {
    background: linear-gradient(135deg, #6a00ff 0%, #c700ff 100%);
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
}

p {
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}

#status {
    margin-top: 1rem;
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Airdrop Claim</h1>
        <button id="connectButton">Connect Wallet</button>
        <button id="disconnectButton" style="display: none;">Disconnect Wallet</button>
        <p id="account">Not connected</p>
        <p id="eligibleAmount"></p>
        <p id="tokenBalance"></p>
        <button id="claimButton" disabled>Claim Airdrop</button>
        <p id="status"></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.5.3/dist/ethers.umd.min.js"></script>
    <script>
      const contractAddress = 'YOUR_CONTRACT_ADDRESS';
const contractABI = [
    {
        "inputs": [],
        "name": "claimAirdrop",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "_address",
                "type": "address"
            }
        ],
        "name": "getAirdropAmount",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "address",
                "name": "recipient",
                "type": "address"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "AirdropClaimed",
        "type": "event"
    }
];

let provider;
let selectedAccount;
let ethersProvider;
let contract;

async function connectWallet() {
    if (window.ethereum) {
        provider = window.ethereum;

        try {
            await provider.request({ method: 'eth_requestAccounts' });
            provider.on("chainChanged", handleChainChanged);
            provider.on("accountsChanged", handleAccountsChanged);
            await checkNetwork();
            ethersProvider = new ethers.providers.Web3Provider(provider);
            const accounts = await ethersProvider.listAccounts();
            selectedAccount = accounts[0];
            document.getElementById('account').textContent = `Connected: ${selectedAccount}`;
            document.getElementById('connectButton').style.display = 'none';
            document.getElementById('disconnectButton').style.display = 'block';
            checkEligibility();
            getTokenBalance();
        } catch (error) {
            console.error("Could not connect to wallet", error);
            document.getElementById('status').textContent = `Error: ${error.message}`;
        }
    } else {
        document.getElementById('status').textContent = 'MetaMask not found. Please install MetaMask and try again.';
    }
}

function handleChainChanged() {
    window.location.reload();
}

function handleAccountsChanged(accounts) {
    if (accounts.length === 0) {
        disconnectWallet();
    } else {
        selectedAccount = accounts[0];
        document.getElementById('account').textContent = `Connected: ${selectedAccount}`;
        checkEligibility();
        getTokenBalance();
    }
}

async function checkNetwork() {
    const chainId = await provider.request({ method: 'eth_chainId' });
    if (chainId !== '0x38') { // BSC Mainnet chain ID is 56 (0x38 in hexadecimal)
        try {
            await provider.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: '0x38' }]
            });
        } catch (switchError) {
            if (switchError.code === 4902) {
                try {
                    await provider.request({
                        method: 'wallet_addEthereumChain',
                        params: [
                            {
                                chainId: '0x38',
                                chainName: 'Binance Smart Chain Mainnet',
                                nativeCurrency: {
                                    name: 'BNB',
                                    symbol: 'BNB',
                                    decimals: 18
                                },
                                rpcUrls: ['https://bsc-dataseed.binance.org/'],
                                blockExplorerUrls: ['https://bscscan.com/']
                            }
                        ]
                    });
                } catch (addError) {
                    console.error(addError);
                }
            }
        }
    }
}

async function checkEligibility() {
    if (!provider) return;
    contract = new ethers.Contract(contractAddress, contractABI, ethersProvider);

    try {
        const amount = await contract.getAirdropAmount(selectedAccount);
        if (amount > 0) {
            document.getElementById('eligibleAmount').textContent = `You are eligible to claim ${amount} tokens`;
            document.getElementById('claimButton').disabled = false;
        } else {
            document.getElementById('eligibleAmount').textContent = `No airdrop available or already claimed`;
        }
    } catch (error) {
        console.error(error);
        document.getElementById('status').textContent = `Error: ${error.message}`;
    }
}

async function getTokenBalance() {
    if (!provider) return;

    try {
        const balance = await ethersProvider.getBalance(selectedAccount);
        document.getElementById('tokenBalance').textContent = `Your token balance: ${ethers.utils.formatEther(balance)} BNB`;
    } catch (error) {
        console.error(error);
        document.getElementById('status').textContent = `Error: ${error.message}`;
    }
}

async function claimAirdrop() {
    if (!provider) return;
    const signer = ethersProvider.getSigner();
    const contract = new ethers.Contract(contractAddress, contractABI, signer);

    try {
        const tx = await contract.claimAirdrop();
        document.getElementById('status').textContent = `Transaction sent: ${tx.hash}`;
        await tx.wait();
        document.getElementById('status').textContent = 'Airdrop claimed!';
        document.getElementById('eligibleAmount').textContent = `You have already claimed your airdrop`;
        document.getElementById('claimButton').disabled = true;
        getTokenBalance(); // Refresh token balance after claim
    } catch (error) {
        console.error(error);
        document.getElementById('status').textContent = `Error: ${error.message}`;
    }
}

function disconnectWallet() {
    provider = null;
    selectedAccount = null;
    ethersProvider = null;
    contract = null;
    document.getElementById('account').textContent = 'Not connected';
    document.getElementById('connectButton').style.display = 'block';
    document.getElementById('disconnectButton').style.display = 'none';
    document.getElementById('eligibleAmount').textContent = '';
    document.getElementById('tokenBalance').textContent = '';
    document.getElementById('status').textContent = '';
    document.getElementById('claimButton').disabled = true;
}

   document.getElementById('connectButton').addEventListener('click', connectWallet);
   document.getElementById('disconnectButton').addEventListener('click', disconnectWallet);
   document.getElementById('claimButton').addEventListener('click', claimAirdrop);
    </script>
</body>
</html>

